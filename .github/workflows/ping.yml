name: Ping Website Randomly

on:
  schedule:
    - cron: '*/9 * * * *'  # Runs every 9 minutes; exact interval is randomized below

jobs:
  ping_and_wait:
    runs-on: ubuntu-latest
    steps:
      - name: Random wait between 8 and 12 minutes
        uses: AliSajid/random-wait-action@v2.11.0
        with:
          minimum: 480    # 8 minutes (in seconds)
          maximum: 720    # 12 minutes (in seconds)

      - name: Ping the website and check for "pong"
        id: ping
        run: |
          response=$(curl -fs --max-time 10 https://twok17.onrender.com/ping || echo "")
          if [ "$response" = "pong" ]; then
            echo "status=up" >> $GITHUB_OUTPUT
          else
            echo "status=down" >> $GITHUB_OUTPUT
          fi

      - name: Wait 2 minutes if website is DOWN
        if: steps.ping.outputs.status == 'down'
        run: sleep 120
