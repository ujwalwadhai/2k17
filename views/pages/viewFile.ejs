<!DOCTYPE html>
<html data-theme="<%= theme || 'purple' %>" lang="en">

<head>
  <%- include('../partials/head') %>
  <title><%= file.name %> - 2k17</title>
  <link rel="stylesheet" href="/styles/css/viewFile.css">
  <meta property="og:image" content="<%= file.thumbnail || '/images/web_logo.png' %>">
</head>

<body>
  <%- include('../partials/navbar') %>
  <br><br>

  <% if(file.type === 'image') { %>
  <div id="view-image-popup" class="view-file-popup" data-file-id="<%= file._id %>">
    <div class="overlay" data-action="close"></div>
    <div class="view-file-box">
      <header class="view-file-header">
        <div class="file-info">
          <i class="fal fa-image"></i>
          <span class="file-name"><%= file.name %></span>
        </div>
        <div class="action-buttons">
          <button class="action-btn" data-action="like" aria-label="Like"><i class="<%- user && file.likes.includes(user._id) ? 'fas' : 'fal' %> fa-heart" id="like-icon-<%= file.id %>"></i></button>
          <button class="action-btn" data-action="share" data-thumbnail="<%= file.thumbnail %>" aria-label="Share"><i class="fal fa-share"></i></button>
          <button class="action-btn" data-action="comment" aria-label="Comments"><i class="fal fa-message-lines"></i></button>
        </div>
      </header>
      <div class="view-file-content">
        <% if(user && file.people && file.people.includes(user._id)){ %>
        <button class="action-btn tag-memory" id="tagBtn" style="background-color: #ff4757; border: 0.5px solid #ff4757;" onclick="tagMemory('<%= file._id %>')" aria-label="Tag Memory">Untag from this memory</button>
        <% } else { %>
        <button class="action-btn tag-memory" id="tagBtn" onclick="tagMemory('<%= file._id %>')" aria-label="Tag Memory">I'm in this memory</button>
        <% } %>
        <img src="<%= file.url %>" alt="<%= file.name %>" oncontextmenu="return false;">
      </div>
    </div>
  </div>

  <% } else if (file.type === 'video') { %>
  <div id="view-video-popup" class="view-file-popup" data-file-id="<%= file._id %>">
    <div class="overlay" data-action="close"></div>
    <div class="view-file-box">
      <header class="view-file-header">
        <div class="file-info">
          <i class="fal fa-video"></i>
          <span class="file-name"><%= file.name %></span>
        </div>
        <div class="action-buttons">
          <button class="action-btn" data-action="like" aria-label="Like"><i class="fal fa-heart" id="like-icon-<%= file.id %>"></i></button>
          <button class="action-btn" data-action="share" data-thumbnail="<%= file.thumbnail %>" aria-label="Share"><i class="fal fa-share"></i></button>
          <button class="action-btn" data-action="comment" aria-label="Comments"><i class="fal fa-message-lines"></i></button>
        </div>
      </header>
      <div class="view-file-content">
        <% if(user && file.people && file.people.includes(user._id)){ %>
        <button class="action-btn tag-memory" id="tagBtn" style="background-color: #ff4757; border: 0.5px solid #ff4757;" onclick="tagMemory('<%= file._id %>')" aria-label="Tag Memory">Untag from this memory</button>
        <% } else { %>
        <button class="action-btn tag-memory" id="tagBtn" onclick="tagMemory('<%= file._id %>')" aria-label="Tag Memory">I'm in this memory</button>
        <% } %>
        <video src="<%= file.url %>" controls controlslist="nodownload" oncontextmenu="return false;">
          Your browser does not support the video tag.
        </video>
      </div>
    </div>
  </div>
  <% } %>

  <div id="comments-popup">
    <div class="overlay" onclick="closeComments()"></div>
    <div class="comments-box">
      <div class="heading">
        <p>Comments</p>
        <p class="close-icon fas fa-times" onclick="closeComments()"></p>
      </div>
      <div class="comments-list" id="comments-list"></div>
      <div class="input-area">
        <input id="new-comment" autocomplete="off" placeholder="Write a comment..." />
        <button type="button" id="newCommentBtn">Post</button>
      </div>
    </div>
  </div>

  <script>
    const FILE_ID = "<%= file._id %>";
    const USER_ID = "<%- user ? user._id : null %>";
  </script>
  <script src="/js/viewFile.js"></script>

  <div id="toast-container" style="position: absolute; bottom: 32px; left: 50%; transform: translateX(-50%); z-index: 9999;"></div>

</body>

</html>